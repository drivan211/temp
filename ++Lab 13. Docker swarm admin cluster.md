Для выполнения ваших заданий с использованием Docker Swarm и образа containous/whoami, давайте пошагово пройдем через описание всех действий.

### Шаг 1: Создание кластера

- **Создание мастер ноды и трех воркер нод**:

- На платформе Play with Docker создайте мастер ноду.

- Добавьте три воркер ноды.

- Инициализируйте кластер на мастер ноде:

     ```
docker swarm init
```
- Выдайте токен, чтобы добавить воркер ноды (команда будет выведена после инициализации).

- **Добавление воркер нод**:

- На каждой из трех воркер нод используйте команду присоединения:

     ```
docker swarm join --token <TOKEN> <MASTER-IP>:<PORT>
```

### Шаг 2: Развертывание сервиса

- **Создайте файл docker-compose.yml** для вашего сервиса whoami:

   ```
version: '3.8'

   services:
     whoami:
       image: containous/whoami
       deploy:
         replicas: 6
         placement:
           constraints: [node.role == worker]
       ports:
         - "80"
```
- **Разверните стек** с сервисом:

   ```
docker stack deploy -c docker-compose.yml my_stack
```

### Шаг 3: Изменение статуса нод

- **Повысьте одну из воркер нод до статуса мастера**:

   ```
docker node promote <WORKER_NODE_ID>
```
- **Понизьте первую мастер ноду до статуса воркера**:

   ```
docker node demote <MASTER_NODE_ID>
```

### Шаг 4: Работа с нодами

- **Выключите одну ноду (принудительно удалить)**:

- Выберите одну из нод и удалите ее через интерфейс или команду:

   ```
docker node rm -f <NODE_ID>
```
- **Проверьте, как перераспределились контейнеры**:

   ```
docker service ps my_stack_whoami
```

### Шаг 5: Добавление новой воркер ноды

- **Добавьте еще одну воркер ноду**:

- Используйте команду присоединения на новой ноде:

   ```
docker swarm join --token <TOKEN> <MASTER-IP>:<PORT>
```
- **Посмотрите на перераспределение контейнеров** снова:

   ```
docker service ps my_stack_whoami
```

### Шаг 6: Создание yml файла произвольного сервиса с политикой обновления

- **Создайте новый файл docker-compose-update.yml**:

   ```
version: '3.8'

   services:
     my_service:
       image: nginx
       deploy:
         replicas: 3
         update_policy:
           parallelism: 1
           delay: 10s
       ports:
         - "8080:80"
```
- **Разверните стек с обновленным сервисом**:

   ```
docker stack deploy -c docker-compose-update.yml my_service_stack
```

### Заключение

В результате выполнения этих шагов вы создали кластер Docker Swarm с необходимыми репликами, изменили статусы узлов, остановили одну из нод и добавили новую, также создали новый сервис с политикой обновления. Это помогло вам ознакомиться с основными функциями управления кластером Docker Swarm. Не забудьте использовать команды инспекции для проверки состояния сервисов и нод.
